{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advocate Dashboard</title>
  <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body>
  <!-- Sidebar Navigation -->
  <aside class="sidebar">
    <div class="flex justify-between items-center mb-6">
      <h2>Advocate Dashboard</h2>
      <button class="toggle-sidebar" id="toggle-sidebar">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>
    <ul>
      <li><strong>Full Name:</strong> {{ advocate.user.first_name }} {{ advocate.user.last_name }}</li>
      <li><strong>Enrollment Number:</strong> {{ advocate.enrollment_number }}</li>
      <li><strong>Email:</strong> {{ advocate.email }}</li>
      <li><strong>Mobile Number:</strong> {{ advocate.phone }}</li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="container">
    <header>
      <h1>Legal Document Dashboard</h1>
    </header>

    <div class="main-content">
      <!-- Chatbot Section -->
      <section class="chatbot">
        <h2>Legal Assistant Chatbot</h2>
        <label for="docType">Select Document Type:</label>
        <select id="docType">
          <option value="">-- Choose Document --</option>
          <option value="divorce">Divorce Notice</option>
          <option value="nda">Non-Disclosure Agreement</option>
          <option value="sale_deed">Sale Deed</option>
          <option value="noc">No Objection Certificate</option>
        </select>
        <div id="chat-box" class="chatbox"></div>
        <form id="chat-form" class="chat-form">
          {% csrf_token %}
          <input id="query" name="query" type="text" placeholder="Type your response…" required autocomplete="off" />
          <button type="submit">Send</button>
        </form>
        <div id="link-section"></div>
      </section>

      <!-- Client History Sections -->
      <div class="client-history-wrapper">
        <!-- Divorce Client History --> 
        <section class="client-history">
          <h2>Divorce Clients</h2>
          {% if clients %}
          <div class="table-wrapper">
            <table class="client-table">
              <thead>
                <tr>
                  <th>Filer</th>
                  <th>Husband's Name</th>
                  <th>Wife's Name</th>
                  <th>Marriage Date</th>
                  <th>Document 1</th>
                  <th>Document 2</th>
                </tr>
              </thead>
              <tbody>
                {% for client in clients reversed %}
                <tr>
                  <td>{{ client.filer }}</td>
                  <td>{{ client.husband_name }}</td>
                  <td>{{ client.wife_name }}</td>
                  <td>{{ client.marriage_Date|date:"d-m-Y" }}</td>
                  <td>{% if client.document_version_1 %}<a href="{{ client.document_version_1.url }}">Download</a>{% else %}—{% endif %}</td>
                  <td>{% if client.document_version_2 %}<a href="{{ client.document_version_2.url }}">Download</a>{% else %}—{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <p>No clients found.</p>
          {% endif %}
        </section>

        <!-- NDA Client History -->
        <section class="client-history">
          <h2>NDA Clients</h2>
          {% if nda_list %}
          <div class="table-wrapper">
            <table class="client-table">
              <thead>
                <tr>
                  <th>Disclosing Party</th>
                  <th>Receiving Party</th>
                  <th>Effective Date</th>
                  <th>Duration</th>
                  <th>Document 1</th>
                  <th>Document 2</th>
                </tr>
              </thead>
              <tbody>
                {% for nda in nda_list %}
                <tr>
                  <td>{{ nda.disclosing_party_name }}</td>
                  <td>{{ nda.receiving_party_name }}</td>
                  <td>{{ nda.effective_date|date:"d-m-Y" }}</td>
                  <td>{{ nda.duration }} year(s)</td>
                  <td>{% if nda.document_version_1 %}<a href="{{ nda.document_version_1.url }}">Download</a>{% else %}—{% endif %}</td>
                  <td>{% if nda.document_version_2 %}<a href="{{ nda.document_version_2.url }}">Download</a>{% else %}—{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <p>No NDA records found.</p>
          {% endif %}
        </section>

        <!-- Sale Deed Client History -->
        <section class="client-history">
          <h2>Sale Deed Records</h2>
          {% if sale_deeds %}
          <div class="table-wrapper">
            <table class="client-table">
              <thead>
                <tr>
                  <th>Seller Name</th>
                  <th>Buyer Name</th>
                  <th>Property Address</th>
                  <th>Sale Amount</th>
                  <th>Document 1</th>
                  <th>Document 2</th>
                </tr>
              </thead>
              <tbody>
                {% for sale_deed in sale_deeds %}
                <tr>
                  <td>{{ sale_deed.seller_name }}</td>
                  <td>{{ sale_deed.buyer_name }}</td>
                  <td>{{ sale_deed.property_address }}</td>
                  <td>₹{{ sale_deed.sale_amount }}</td>
                  <td>{% if sale_deed.document_version_1 %}<a href="{{ sale_deed.document_version_1.url }}">Download</a>{% else %}—{% endif %}</td>
                  <td>{% if sale_deed.document_version_2 %}<a href="{{ sale_deed.document_version_2.url }}">Download</a>{% else %}—{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <p>No Sale Deed records found.</p>
          {% endif %}
        </section>

        <!-- NOC Client History -->
        <section class="client-history">
          <h2>No Objection Certificates</h2>
          {% if nocs %}
          <div class="table-wrapper">
            <table class="client-table">
              <thead>
                <tr>
                  <th>NOC Type</th>
                  <th>Issuing Party</th>
                  <th>Receiving Party</th>
                  <th>Issue Date</th>
                  <th>Document 1</th>
                  <th>Document 2</th>
                </tr>
              </thead>
              <tbody>
                {% for noc in nocs %}
                <tr>
                  <td>{{ noc.noc_type }}</td>
                  <td>{{ noc.party_issuing }}</td>
                  <td>{{ noc.party_receiving }}</td>
                  <td>{{ noc.date_issued|date:"d-m-Y" }}</td>
                  <td>{% if noc.document_version_1 %}<a href="{{ noc.document_version_1.url }}">Download</a>{% else %}—{% endif %}</td>
                  <td>{% if noc.document_version_2 %}<a href="{{ noc.document_version_2.url }}">Download</a>{% else %}—{% endif %}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
          {% else %}
          <p>No NOC records found.</p>
          {% endif %}
        </section>
      </div>
    </div>
  </main>

  <!-- JavaScript for Sidebar Toggle -->
  <script>
    const toggleSidebar = document.getElementById('toggle-sidebar');
    const sidebar = document.querySelector('.sidebar');
    const container = document.querySelector('.container');

    toggleSidebar.addEventListener('click', () => {
      sidebar.classList.toggle('sidebar-active');
      container.classList.toggle('sidebar-active');
    });
  </script>
  <!-- External chatbot logic -->
  <script src="{% static 'js/chatbot.js' %}"></script>
</body>
</html>